<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Сниппет TSVShop</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<style type="text/css" media="screen">
* { margin: 0; padding: 0;}
html {  /*BACKGROUND: url(gridbg1.gif) transparent*/; background: #fff; font: 12px/18px Tahoma, Verdana, Arial, Helvetica, sans-serif; padding: 0px 36px; }

body, td, th, h3, h6 {
	color: #330000; line-height:18px;
}

h1, h2, h3, h4 { display:block; padding-bottom: 5px; font-family:  Verdana, Arial, Helvetica, sans-serif;  font-weight: normal; margin-bottom:15px; border-bottom:1px solid #ccc}
h1 { font-size: 200%; margin-top: 27px;font-weight: bold;margin-bottom:18px;color: #6F9400}
h2 { font-size: 170%; margin-top: 18px;}
h3 { font-size: 140%; margin-top: 18px;}
h4 { font-size: 110%; font-weight: bold; margin-top: 18px;}

p, ul, ol,  pl { margin-bottom: 18px; }
ul, ol  {margin-left:36px;}
a {	color: #001767;}

pre, code { font: 1.2em/1.8 "Courier New", Courier, monospace; border: 1px dashed #aaa; padding: 1em; background: #C6CABA; }
code { display:block; padding: .2em .5em; }
blockquote { margin-left: 10em; padding-bottom:5px; padding-left: 1em; border-left: 2px solid #ccc; background: #f9f9f9;}
table { border-collapse: collapse; width: 100%; }
table th, table td { border: 1px solid #ccc; padding: 3px 4px; }
table th { background: #f4f4f4; }
table td {  }
table td.head {font-weight:bold; text-align:center; background:#f4f4f4;}
</style>
</head>

<body>
<h1>Сниппет/Модуль TSVshop</h1>
<p>Сниппет, модуль, плагин для создания корзины заказов на сайте.  Разработка - <b>Тельный Сергей</b> (<a href="mailto:privat_tel@mail.ru">privat_tel@mail.ru</a>), спасибо <b>Матюхину Максиму</b> (<a href="mailto:matuhinmax@mail.ru">matuhinmax@mail.ru</a>), <b>Александру Полякову</b> (<a href="mailto:lecosson@gmail.com">lecosson@gmail.com</a>). По всем замечаниям и вопросам пишите на <a href="mailto:privat_tel@mail.ru">privat_tel@mail.ru</a> или в скайп Sergey22.</p>
<p>Официальный сайт: <a href="http://tsvshop.tsv.org.ua">http://tsvshop.tsv.org.ua</a>, <a href="http://tsvshop.xyz">http://tsvshop.xyz</a></p>

<h2>Важные изменения</h2>

<p>Теперь список всех изменений будет доступен на странице проекта GitHub <a href="https://github.com/Serg28/tsvshop/releases">https://github.com/Serg28/tsvshop/releases</a></p>

<p><strong>Версия V5.3</strong></p>
<ul>
<li>&nbsp;<strong>Важные:</strong> введены два новых поля в таблицу заказа <em>shop_order</em>: <span style="text-decoration: underline;">topay</span> и <span style="text-decoration: underline;">dateorder</span></li>
</ul>
<ol>
<li style="list-style-type: none;"><ol>
<li><span style="text-decoration: underline;">topay</span> - сумма к оплате. Эта сумма может отличаться от итоговой суммы (плейсхолдер [+shop.basket.total+]), в случае, если установлен аддон Подарочные сертификаты (и подобные, когда пользователь может часть суммы оплатить подарочным сертификатом, а оставшуюся &ndash; другими способами). В таком случае [+shop.basket.topay+] отобразит <span style="text-decoration: underline;">оставшуюся</span> сумму, которую нужно <span style="text-decoration: underline;">доплатить</span>. В остальных случаях [+shop.basket.topay+] равен [+shop.basket.total+].</li>
<li><span style="text-decoration: underline;">datepay</span> - дата совершения оплаты заказа. В основном используется для вывода информации в админке модуля. Дата оплаты записывается автоматически, если оплата прошла с помощью аддона Методы оплаты.</li>
</ol></li>
</ol>
<p style="margin-left: 30px;">Эти нововведения были отражены в документации к чанкам: <a href="dokumentacziya/dlya-veb-masterov/chanki-plejsxolderyi/">http://tsvshop.tsv.org.ua/dokumentacziya/dlya-veb-masterov/chanki-plejsxolderyi/</a> и в подсказках, выводимых при редактировании чанков (плагином HINTx).</p>
<ul>
<li>Восстановлена работа плагина HINTx, предназначенного для создания подсказок для чанков и шаблонов, используемых в TSVshop. Подсказки выводятся в режиме редактирования соответствующих чанков и шаблонов, чтобы напоминать о плейсхолдерах, используемых в них.</li>
<li>Для плагина HINTx отредактированы подсказки в соответствии с новой версией 5.3</li>
<li>Удалены старые файлы, оставшиеся от прошлых версий.</li>
<li>Исправлена ошибка в екстендере Ditto shop, когда не удавалось корректно производить стандартную сортировку в Ditto. Теперь по-умолчанию работает&nbsp; стандартная сортировка Ditto (если не указан &amp;sortByPrice). Если же указан &amp;sortByPrice=`price` или &amp;sortByPrice=`param`, сортируется по цене или параметрам товара соответственно.</li>
<li>Исправлены ошибки TSVoffice: теперь корректно работает шифрование пользовательских данных (раньше оно было отключено из-за ошибки, возникающей при сохранении зашифрованных данных в БД) и вывод информации о выбранном заказе (ранее при отображении данных о выбранном заказе возникала ошибка: Такого заказ нет.)</li>
<li>В файле /assets/snippets/tsvshop/admin/includes/core.inc.php заменены mysql_ на $modx-&gt;db, исправлена ошибка шифрования данных и добавлена возможность отсылать админу и клиенту в письме несколько файлов. Для этого служит функция send_mail($to, $subject, $content, $attach=false), где $attach может быть строкой или массивом: можно передать путь к файлу как строку, или же как массив с путями к нескольким файлам, напр., $attach = array('filepath1','filepath2');</li>
<li>В файле /assets/snippets/tsvshop/include/apiinit.inc.php устранено появление ошибки отстутствия функции getMicroTime(), появлявшейся при обновлении инфоблока методом AJAX. Также добавлена защита с помощью инклуда файла&nbsp; /manager/includes/protect.inc.php</li>
<li>Введена проверка на существование (и автоматического добаление) поля typeitem в таблице БД shop_order_detail для совместимости с версиями 5.0 и ранее, где это поле не использовалось.</li>
<li>Теперь в корзине и форме оформления заказа автоматически скрываются те части чанка, которые в данный момент не используются аддонами. Тоесть, например, если у вас не установлен аддон Методы доставки (или он отключен), в форме оформления заказа не будет отображаться кусочек кода, отвечающий за выбор метода доставки. То же касается и корзины. &nbsp;Чтобы это работало, в чанках корзины и формы заказа должны быть метки аддонов (см. документацию к чанкам).</li>
<li>Модуль TSVshop теперь поддерживает смену названия папки менеджера.</li>
<li>Исправлена ошибка сниппет TSVshop_options, когда не выводился параметр товара в карточке товара, если был всего лишь один параметр/</li>
<li>Исправлена ошибка, когда после инсталляции модуля создавалось два одиниковых шаблона Карточка товара.</li>
</ul>
<p><strong>Версия V5.2.2</strong></p>
<ul>
<li>Устранена ошибка, когда в личном кабинете (сниппет TSVoffice) не работал просмотр выбранного заказа.</li>
</ul>
<p><strong><strong>Версия V5.2.1 rc2</strong></strong></p>
<p>Список изменений в процессе подготовки</p>
<p><strong>Версия V5.0 rc</strong></p>
<ul>
<li>Устранена ошибка шифрования данных покупателя: теперь эти данные шифруются/расшифровываются корректно.<strong><br /></strong></li>
<li>По-умолчанию устанавливается сниппет TSVoffice, а при установке демо-контента личный кабинет полностью настраивается<strong>.</strong></li>
<li>Сниппет TSVoffice обновлен до версии 1.0.1 (введена проверка пользователя на авторизацию при просмотре заказа)</li>
<li>В конфигурации модуля по умолчанию отключены отсутствующие аддоны. Раньше они были включены и в корзине отображались пустые поля.</li>
<li>Правка чанка Shop_Cart - не работала кнопка очистки корзины.</li>
<li>Исправлена ошибка, когда при отсутствии параметра hideon (скрытие инфоблока) выдавалась ошибка.</li>
<li>Исправлена ошибка, когда в инфоблоке неправильно формировалась ссылка на корзину.</li>
<li>Теперь в письмах с заказом пользователю и админу можно вставлять кастомные плейсхолдеры. В форме заказа можно добавлять поля, значения которых вставляются в эти плейсхолдеры (как это обычно есть в сниппете eForm).</li>
</ul>
<p><strong>Версия V4.9.1 rc</strong></p>
<ul>
<li>Исправлены две синтаксические ошибки.<strong><br /></strong></li>
</ul>
<b>Версия V4.9 rc</b><br>
<ul>
<li>Добавлена возможность продавать файлы. Для этого были внесены соответвующие изменения в ядро модуля, а также разработан плагин <b>TSVshop_downloads</b></li>
<li>В сниппете TSVshop для режима инфоблока <i>&act=`info`</i> добавлен параметр <i>hideon</i>, который принимает ИД документов, через запятую. Это позволяет скрывать инфоблок на соответствующих страницах. </li>
<li>Исправлена ошибка, когда неправильно зашифровывались/расшифровывались данные пользователя.</li>
<li>В аддоне "Заказы" добавлена возможность распечатать выбранный заказ.</li>
<li>Исправлена ошибка в документации: в шаблоне карточки товара для отдельной страницы 2 раза встречался плейсхолдер [+tsvoptions+]. Нужно только один, а
второй [+tsvservices+]</li>
<li>Экстендеры для Ditto: shop и sortprice объединены в один. Соответсвенно, екстендер sortprice не нужно вставлять в вызов Ditto. Достаточно только shop</li>
<li>Добавлено новое событие: <li>TSVshopOnOrderStatusUpdate</li>, которое срабатывает при
обновлении статуса заказа. Принимает массив с данными: <i>idorder</i> - номер заказа,
<i>newstatus</i> - новый статус.</li>
<li>В соответствии с вышеперечисленным, обновлена документация.</li>
</ul>

<h2>Важные изменения</h2>
<b>Версия V4.7 rc1</b><br>
<ul>
<li>В комплект TSVshop добавлен сниппет TSVoffice для создания личного кабинета пользователя, позволяющего ему регистрироваться, авторизовываться, редактировать свой профиль и просматривать свои заказы. Документация к сниппету находится по адресу: /assets/snippets/tsvoffice/readme.docx</li>
<li>В комплект TSVshop добавлен файл-extender для сниппета Ditto, позволяющий сортировать товары магазина по цене-формуле и параметрам товара.</li>
<li>Добавлено действие для сниппета &act=`itemcard`, предназначенное для вставки в карточку товара. Теперь упростилась структура вывода информации в карточке товара. Подробнее читайте выше: раздел <b>Автоматическая установка</b>, пункт 8.4 или <b>Ручная установка</b>, пункт 30.</li>
<li>Добавлено событие <i>TSVshopOnViewItemCard</i>, срабатывающее при просмотре карточки товара. Его можно обрабатывать плагином, например, для подсчета просмотров товара.</li>
<li>Изменены названия плейсхолдеров в чанке товара <i>product</i>: options на tsvoptions, total_price на tsvprice, button_atributes на tsvbattr</li>
Изменен алгоритм шифрования личной информации пользователя. Теперь используется алгоритм XXTEA.
<li>Больше нету понятия краткая и полная версия инфоблока. Есть только версия для полной и пустой корзины.</li>
<li>Исправлены многие ошибки, в том числе проблемы при установке модуля, неправильного формирования адреса товара в корзине</li>
</ul>

<h2>Автоматическая установка</h2>
<p>ВАЖНО! Этот вариант установки можно делать ТОЛЬКО на уже установленный MODx. Поэтому прежде чем вы последуете нижеприведенным шагам, установите сначала MODx обычным способом. </p><p>После этого делаем следующее: </p>

<p>Видеоинструкция установки: <a href="http://tsvshop.tsv.org.ua/dokumentacziya/dlya-veb-masterov/ustanovka-modulya.html">http://tsvshop.tsv.org.ua/dokumentacziya/dlya-veb-masterov/ustanovka-modulya.html</a></p>

<ol>
<li>Скачайте архив модуля и распакуйте его. После распаковки вы увидите две папки: <i>assets</i> и <i>install</i>. </li>
<li>Разместите эти папки в корень вашего сайта поверх уже существующих папок.  </li>
<li>На файлы <b>/assets/snippets/tsvshop/js/config.js</b> и <b>/assets/snippets/tsvshop/include/config.inc.php</b> нужно выставить права на запись (обычно 666)</li>
<li>Перейдите в браузере по пути <i>http://ваш.домен/install</i>. Начнется процесс установки, напоминающий стандартную установку MODx. Пройдите его полностью до конца. На странице выбора устанавливаемых компонентов отметьте галочками все, что вам нужно (а нужно все). После установки будут созданы все необходимые компоненты. </li>
<li>В случае, если вы устанавливаете модуль на "пустой" MODx (без контента), крайне желательно, чтобы вы установили ДЕМО-КОНТЕНТ, т.к. при этом создадутся все необходимые для работы модуля страницы (<span style="color:red">на работающем сайте ДЕМО-КОНТЕНТ ставить нельзя, т.к. он может удалить существующие страницы. В таком случае для создания нужных страниц смотрите пункт 8</span>). Далее вы сможете уже подкорректировать или совсем сменить дизайн и т.д. </li>
<li>Зайдите в админку и перейдите на вкладку МОДУЛИ -&gt; TSVshop. Там в разделе <i>Аддоны</i> установите нужные вам аддоны. </li>
<li>В разделе <i>Конфигурация</i> выполните все нужные настройки. </li>
<li>В случае, если вы устанавливаете модуль на РАБОТАЮЩИЙ сайт (не устанавливали ДЕМО-КОНТЕНТ), создайте три документа, где будут <b>Корзина</b>, <b>Оформление покупки</b> и <b>Завершение покупки</b> (сделайте скрытой); Далее:
<ol><li>Для <b>Корзины</b> вызов сниппета такой:<br /> <code>[!TSVshop? &act=`basket` &checkid=``!]</code> – где <i>checkid</i> – ИД страницы оформления покупки;</li>
<li>Для <b>Оформления покупки</b> вызов такой:<br /> <code>[!TSVshop? &act=`checkout` &backid=``!]</code> – где <i>backid</i> – ИД страницы, куда переход после успешной покупки;</li>
<li>Для <b>Завершения покупки</b> такой:<br /> <code>[!TSVshop? &act=`finish`!]</code></li>
<li>Если вам нужно вставить кнопку добавления товара в корзину на отдельной странице, без использования Ditto, то воспользуйтесь таким кодом:
<code>
[!TSVshop? &act=`itemcard`!]
&lt;form action="" method="post" name="Tovar[*id*]" id="Tovar[*id*]" &gt;
[+tsvoptions+]
  Цена: [+tsvprice+] руб.
  &lt;p&gt;&lt;input type="text" name="qty" value="1" [+tsvbattr+] /&gt;&lt;/p&gt;
   &lt;a href="javascript: void(0);" onclick="AddToCart('[*id*]');return false"&gt;В корзину&lt;/a&gt;
[+tsvservices+]
&lt;/form&gt;
</code>
  Обратите внимание, что обязательно наличие вызова сниппета [!TSVshop? &act=`itemcard`!], поскольку с его помощью идет обработка плейсхолдеров [+tsvoptions+], [+tsvprice+], [+tsvbattr+] и [+tsvservices+] (это системные плейсхолдеры, вместо которых выводится служебная информация). Также при вызове [!TSVshop? &act=`itemcard`!] срабатывает событие <i>TSVshopOnViewItemCard</i>, которое можно повесить на плагин для обработки карточки товара или для подсчета просмотров товара.
</li>
</ol>

</li>
</ol>

<h2>Ручная установка</h2>
<p>Данный вид установки довольно трудоемкий, поскольку нужно проделать много рутинной работы. Поэтому крайне желательно воспользоваться автоматической установкой. Но если вы все же решили установить TSVshop вручную, то сделайте следующее:</p>
<ol>
<li>Распакуйте архив и полученную папку assets закачайте в корневую папку MODx (где находится папка assets);</li>
<li>Откройте папку /assets/snippets/tsvshop/install, внутри которой вы увидите файлы установки.</li>
<li>Создайте модуль <i>TSVshop</i>, воспользовавшись файлом <b>TSVshop.module.tpl</b> из папки install;</li>
<li>Создайте сниппет <i>TSVshop</i>, воспользовавшись файлом <b>TSVshop.snippet.tpl</b> из папки install;</li>
<li>Создайте сниппет <i>TSVshop_options</i>, воспользовавшись файлом <b>TSVshop_options.snippet.tpl</b> из папки install;</li>
<li>Создайте чанк <i>product</i>, воспользовавшись файлом <b>product.chunk.tpl</b> (с помощью этого чанка и Дитто будет выводиться список товаров) из папки install;</li>
<li>Создайте чанк <i>Shop_Cart</i>, воспользовавшись файлом <b>Shop_Cart.chunk.tpl</b> (шаблон корзины заказов) из папки install;</li>
<li>Создайте чанк <i>Shop_Cart_Empty</i>, воспользовавшись файлом <b>Shop_Cart_Empty.chunk.tpl</b> (шаблон пустой корзины заказов) из папки install;</li>
<li>Создайте чанк <i>Shop_Checkout</i>, воспользовавшись файлом <b>Shop_Checkout.chunk.tpl</b> (шаблон корзины при оформлении заказов) из папки install;</li>
<li>Создайте чанк <i>Shop_Infoblock</i>, воспользовавшись файлом <b>Shop_Infoblock.chunk.tpl</b> (шаблон инфоблока) из папки install;</li>
<li>Создайте чанк <i>Shop_FinishText</i>, воспользовавшись файлом <b>Shop_FinishText.chunk.tpl</b> (выводит сообщение об успешной покупке) из папки install;</li>
<li>Создайте чанк <i>Shop_UserForm</i>, воспользовавшись файлом <b>Shop_UserForm.chunk.tpl</b> (выводит форму для данных пользователя) из папки install;</li>
<li>Создайте чанк <i>Shop_mail_admin</i>, воспользовавшись файлом <b>Shop_mail_admin.chunk.tpl</b> (задает вид письма админу для подтверждения заказа) из папки install;</li>
<li>Создайте чанк <i>Shop_mail_klient</i>, воспользовавшись файлом <b>Shop_mail_klient.chunk.tpl</b> (задает вид письма клиенту для подтверждения заказа) из папки install;</li>
<li>Создайте чанк <i>Shop_UpdateOrder</i>, воспользовавшись файлом <b>Shop_UpdateOrder.chunk.tpl</b> (задает вид письма обновления статуса заказа) из папки install;</li>

<li>Создайте плагин <i>TSVсlearCache</i>, воспользовавшись файлом <b>TSVсlearCache.plugin.tpl</b> из папки install; присвойте события <b>OnCacheUpdate</b>, <b>OnManagerPageInit</b></li>
<li>Создайте плагин <i>TSVshopNotifier</i>, воспользовавшись файлом <b>TSVshopNotifier.plugin.tpl</b> из папки install; присвойте события <b>OnManagerWelcomePrerender</b></li>
<li>Создайте плагин <i>Hints</i>, воспользовавшись файлом <b>Hints.plugin.tpl</b> из папки install; присвойте события <b>OnChunkFormRender</b>, <b>OnTempFormRender</b>, конфигурация <i>&lang=hints language;string;ru</i></li>

<li>Создайте TV-параметр <i>price</i>, в котором будет задаваться цена товара. Присвойте этот параметр шаблону страницы, которая является карточкой товара;</li>
<li>Создайте TV-параметр <i>tsvshop_param</i>, в котором будет задаваться дополнительные свойства товара. Присвойте этот параметр шаблону страницы, которая является карточкой товара;</li>
<li>При необходимости создайте TV-параметр <i>cart_icon</i> с типом ввода Image, в котором будет задаваться иконка товара, отображаемая в корзине. Присвойте этот параметр шаблону страницы, которая является карточкой товара;</li>

<li>Создайте три документа, где будут <b>Корзина</b>, <b>Оформление покупки</b> и <b>Завершение покупки</b> (сделайте скрытой);</li>
<li>На файлы <b>/assets/snippets/tsvshop/js/config.js</b> и <b>/assets/snippets/tsvshop/include/config.inc.php</b> нужно выставить права на запись.</li>
<li>Для <b>Корзины</b> вызов сниппета такой:<br /> <code>[!TSVshop? &act=`basket` &checkid=`` &namesource=`` &tplcart=`имя_чанка_или_путь_к_файлу` &tplcartempty=`имя_чанка_или_путь_к_файлу` !]</code> – где <i>checkid</i> – ИД страницы оформления покупки; <i>&namesource=``</i> - поле документа, откуда брать название товара, напр., longtitle, pagetitle, menutitle. По умолчанию - pagetitle;  <i>&tplcart=``</i> - имя чанка или путь к файлу (напр., @FILE:путь_от_корня_сайта/имя_файла) с шаблоном корзины. По умолчанию чанк Shop_Cart. То же касается и <i>&tplcartempty=``</i> - чанк или файл корзины, когда она пуста. По умолчанию чанк Shop_Cart_Empty</li>
<li>Для <b>Оформления покупки</b> вызов такой:<br /> <code>[!TSVshop? &act=`checkout` &backid=`` &tplcheckout=`имя_чанка_или_путь_к_файлу` &tpluserform=`имя_чанка`!]</code> – где <i>backid</i> – ИД страницы, куда переход после успешной покупки; <i>&tplcheckout=``</i> - имя чанка или путь к файлу (напр., @FILE:путь_от_корня_сайта/имя_файла) с шаблоном корзины. По умолчанию чанк Shop_Checkout; <i>&tpluserform=``</i> - имя чанка с шаблоном формы оформления заказа (поддерживается ТОЛЬКО чанки). По умолчанию - Shop_UserForm</li>
<li>Для <b>Завершения покупки</b> такой:<br /> <code>[!TSVshop? &act=`finish` &tplsuccess=`имя_чанка_или_путь_к_файлу` &tplmailadmin=`имя_чанка_или_путь_к_файлу` &tplmailklient=`имя_чанка_или_путь_к_файлу` &tplmailupdateorder=`имя_чанка_или_путь_к_файлу`!]</code> где <i>&tplsuccess=``</i> - чанк или файл с шаблоном сообщения об успешном оформлении заказа, по умолчанию чанк Shop_FinishText; <i>&tplmailadmin=``</i> - чанк или файл с шаблоном письма админу с информацией о новом заказе, по умолчанию чанк Shop_mail_admin; <i>&tplmailklient=``</i> - чанк или файл шаблона письма клиенту с информацией о его заказе, по умолчанию чанк Shop_mail_klient; <i>&tplmailupdateorder=``</i> - чанк или файл шаблона письма клиенту об изменении статуса его заказа (при смене статуса), по умолчанию чанк Shop_UpdateOrder. В качестве шаблона можно использовать файл: @FILE:путь_от_корня_сайта/имя_файла</li>
<li>В любом месте шаблона страницы или документа, в котором будет выводиться список товаров, вставьте вызов:<br /><code>[[TSVshop? &act=`none`]]</code> – это касается <b>только</b> той страницы, где ни разу не вызывался сниппет TSVshop. Этот вызов вставит в код страницы служебные скрипты, необходимые для работы корзины. На странице корзины, оформления и завершения покупки, а также там, где есть хотя-бы один вызов сниппета TSVshop, этот вызов не делать;</li>
<li>При желании в любую часть страницы можно вставить инфоблок корзины, в котором отображается общая сумма заказа и колличество товаров в корзине со ссылкой на саму корзину. Вызов инфоблока таков: <br /> <code>[[TSVshop? &act=`info` &basketid=`` &hideon=`` &tplinfoblock=`имя_чанка_или_путь_к_файлу`]]</code> – где <i>baskeid</i> – ИД страницы с корзиной; &hideon=`` - список ID документов (через запятую), на которых инфоблок не будет отображаться (будет скрыт); &tplinfoblock=``- имя чанка или путь к файлу (напр., @FILE:путь_от_корня_сайта/имя_файла) с шаблоном инфоблока. По умолчанию чанк Shop_Infoblock.</li>
<li>Теперь в самом каталоге продукции в Ditto используйте чанк product. Например:<br /><code>[[Ditto? &language=`russian` &tpl=`product` &sortDir=`ASC` &extenders=`shop`]]</code> – это выведет продукцию с кнопкой «В корзину». <span style="color:red">ОБРАТИТЕ ВНИМАНИЕ! В вызове Ditto при выводе списка товаров магазина указан параметр <b>&extenders=`shop`</b> - его присутствие обязательно. С его помощью идет обработка чанка product. Без этого параметра добавление в корзину работать не будет.</span></li>
<li>Если вам нужно вставить кнопку добавления товара в корзину на отдельной странице, без использования Ditto, то воспользуйтесь таким кодом:
<code>
[!TSVshop? &act=`itemcard`!]
&lt;form action="" method="post" name="Tovar[*id*]" id="Tovar[*id*]" &gt;
[+tsvoptions+]
  Цена: [+tsvprice+] руб.
  &lt;p&gt;&lt;input type="text" name="qty" value="1" [+tsvbattr+] /&gt;&lt;/p&gt;
   &lt;a href="javascript: void(0);" onclick="AddToCart('[*id*]');return false"&gt;В корзину&lt;/a&gt;
[+tsvservices+]
&lt;/form&gt;
</code>
  Обратите внимание, что обязательно наличие вызова сниппета [!TSVshop? &act=`itemcard`!], поскольку с его помощью идет обработка плейсхолдеров [+tsvoptions+], [+tsvprice+], [+tsvbattr+] и [+tsvservices+] (это системные плейсхолдеры, вместо которых выводится служебная информация). Также при вызове [!TSVshop? &act=`itemcard`!] срабатывает событие <i>TSVshopOnViewItemCard</i>, которое можно повесить на плагин для обработки карточки товара или для подсчета просмотров товара. 
</li>
</ol>

<h2>Экстендеры для Ditto</h2>
<h3>Сортировка товаров по дополнительный параметрам</h3>
  <p>Как писалось в разделе установки, существует екстендер <i>shop</i>, предназначенный для обработки служебных плейсхолдеров сниппета. Его нужно вызвать при выводе товаров с помощью Ditto, чтобы получилось <i>&extenders=`shop`</i>. Кроме того, начиная с версии 4.8 rc модуля, функции экстендера расширены. (для ранних версий был отдельный экстендер sortprice). Добавлена возможность сортировки товаров по цене или дополнительным параметрам товара. Данный экстендер добавляет к Ditto 2 новых параметра: <b>sortDirPrice</b> и <b>sortByPrice</b>.</p>
<p><b>sortByPrice</b> - поле для сортировки: price (по цене) или param (по доп. параметрам)<br /> <b>sortDirPrice</b> - порядок сортировки: ASC (по возрастанию) или DESC (по убыванию) </p>

<p>Например, нам нужно отсортировать все товары по цене в порядке убывания. Но поскольку цена может быть в виде формулы, напр., <b>1-10==100||90</b>, то Ditto не сможет корректно отсортировать товары по цене. В таком случае делаем вызов:</p> 
<code>[[Ditto? &tpl=`product` &sortDir=`ASC` &extenders=`shop` &sortByPrice=`price` &sortDirPrice=`DESC`]]</code>
<p>и все товары будут отсортированы по цене в порядке убывания</p>

<p>Если же, например, у товаров есть дополнительный параметр Диаметр (с помощью плагина TSVsparam), и у каждого диаметра есть своя цена, а нам нужно отсортировать товары не по основной цене, а по цене диаметра. В таком случае делаем вызов:</p>
<code>[[Ditto? &tpl=`product` &sortDir=`ASC` &extenders=`shop` &sortByPrice=`param` &sortDirPrice=`DESC`]]</code>
<p>и все товары будут отсортированы по цене диаметра в порядке убывания. Причем если у товара один из диаметоров будет активным, будет учитываться именно он, в противном случае учитывается первый по счету диаметр</p>
<h3>Разные цены для разных веб-групп</h3>
<p>Также с помощью данного екстендера можно выводить разные цены в зависимости от того, к какой веб-группе относится авторизованный пользователь. Например, у вас есть 3 группы пользователей с названиями <i>group1</i>, <i>group2</i>, <i>group2</i>, для которых нужно показывать разные цены. Для этого нужно создать в Карточке товара дополнительно 3 TV-параметра с ценами для каждой из групп (помимо имеющегося price, в котором идет обычная цена для всех остальных), например, <i>tvprice1</i>, <i>tvprice2</i>, <i>tvprice3</i></p>
<p>Затем в вызове Ditto воспользуемся новым параметром <b>&gtp=``</b>. Достаточно в него добавить простую конфигурацию, которая решит нашу задачу: &gtp=`group1=tvprice1;group2=tvprice2;group3=tvprice3`. Как видно, мы просто вписали наши группы и соответсвующие им TV с ценой для этих групп по такому принципу: <i>имявебгруппы1=имяtvсценой1;имявебгруппы2=имяtvсценой2</i> с разделителем - точка с запятой.</p>

<h2>Манипуляция ценами</h2>
<p>В данной версии сниппета реализована очень удобная функция манипуляцией ценами. Теперь вы можете в качестве цены указать не только стоимость товара, но и несложную формулу, которая вычисляет стоимость товара в зависимости от количества заказанного товара. </p> 
<p>Рассмотрим это на примере. Представим себе, что стоимость товара зависит напрямую от того, сколько единиц товара заказал клиент. Допустим, если заказать от 1 до 5 единиц товаров, то стоимость будет 100 рублей, если от 6 до 10 единиц, то 90, а если от 11 и более, то 80. Чтобы реализовать такую возможность, достаточно в поле Цена указать: 1-5==100||6-10==90||80. Значение 1 и 2 вариантов понятны, последний - это цена, которая применяется, если не соблюдается ни одно условие. Т.е. более 10 единиц товаров. Можно создавать неограниченное количество условий.</p>
<p>Из вышеприведенного примера видно, что принцип построения формулы довольно простой: <b>ОТ1-ДО1==ЦЕНА1||ОТ2-ДО2==ЦЕНА2||ЦЕНА3</b>. Это означает: Если заказать количество товара в промежутке ОТ1 до ДО1 штук, то цена будет ЦЕНА1, если ОТ2 до ДО2, то цена будет ЦЕНА2, если не соблюдается ни одно условие, то цена будет ЦЕНА3.</p>
<p>Итак, в поле Цена (TV-параметр price) можно указывать либо просто цену, либо формулу с условиями.</p>

<h2>Дополнительные параметры товаров (Сниппет TSVshop_options)</h2>
<p>Вы можете задать для каждого товара дополнительные параметры, например, цвет, размер, объем. При этом каждый из параметров может влиять на общую стоимость товара: приплюсовываться, умножаться или вычитаться. А на странице товара или в списке товаров вы можете вывести эти параметры в виде  выпадающего списка, радиокнопки, чекбокса.</p>
<p>Рассмотрим это на примере. Допустим, у товара "Ветровка" есть 2 дополнительных параметра: цвет (красный и синий) и размер (48, 50, 52). При выборе красного цвета цена увеличивается на 100 рублей, а при синем - становится на 20 рублей дешевле. Ну а при выборе любого из размеров цена никак не меняется. Чтобы это реализовать, существует сниппет <b>TSVshop_options</b>.</p>
<p>Сначала установим и настроим его - смотрите раздел УСТАНОВКА, пунткы 5 и 20. После установки и настройки в документе товара у нас будет еще один ТВ - tsvshop_param. При добавлении или редактирования товара в нем мы задаем параметры товара в таком виде: <br /> <code>Группа1; Группа2; …..;</code></p>
<p>Группы параметров разделяются точкой с запятой, а также точкой с запятой ставится после всех групп. Каждая из групп состоит из независимых виджетов.<br /><code>Тип==Название:Параметр1==Значение1||Параметр2==Значение2||...</code></p>
<p><b>Тип</b> – <i><u>Обязательный параметр</u></i>, может принимать 3 значения:</p>
<ol>
<li><i>radio</i> - Переключатели. Используются, когда следует выбрать один вариант из нескольких предложенных;</li>
<li><i>checkbox</i> - Флажки. Позволяют выбрать более одного варианта из предложенных;</li>
<li><i>select</i> - раскрывающейся список.</li>
</ol>
<p><b>Название</b> - <i><u>Не обязательный параметр</u></i>, название группы параметров. Любой текст. Может быть пустым.</p>
<p><b>Параметр</b> - <i><u>Не обязательный параметр</u></i>,  название группы параметров. Любой текст. Может быть пустым. Если начинается с *, тогда этот пункт будет активным при загрузке страницы.</p>
<p>
<b>Значение</b> - <i><u>Обязательный параметр</u></i>. Показывает как отразится на общей стоимости, если выбран данный пункт. Может иметь следующие значения:
</p>
<ol>
<li><b>n</b> - <i>добавит</i> n к первоначальной стоимости</li>
<li><b>*n</b> - <i>умножит</i>  первоначальной стоимости на n</li>
<li><b>-n</b> - <i>отнимет</i> n от первоначальной стоимости</li>
</ol>
<p>Пример (первое значение пусто):<br /><code>==||Подарочная упаковка==35||Подарочная сумочка==50</code></p>
<p>Можно задать параметры со значением "0". Это полезно для параметров, которые не влияют на цену (например цвет). Пример: <code>синий==0||зеленый==0||красный==0</code></p>
<p>Полный пример: <br /><textarea readonly="readonly" cols="100" rows="5">radio==Цвет:синий==0||зеленый==0||*красный==0;checkbox==Дополнения:Доп.насадки==1||Упаковка==2||Документация==-4;select==Комплектация:минимум==*0.8||*стандарт==0||полный фарш==*1.2;</textarea></p>

<h2>Плагин TSVsparam</h2>
<p>Данный плагин позволяет упростить добавление дополнительных параметров товаров. При его использовании отпадает необходимость вручную писать вышеприведенные формулы в TV tsvshop_param. Весь процесс добавления становится интуитивно понятным. Убедитесь сами:</p>
<p><b>Добавление доп. параметров <u>без</u> плагина:</b><br /><br /><img src="noplugin.jpg"></p>
<p><b>Добавление доп. параметров <u>с</u> плагином:</b><br /><br /><img src="plugin.jpg"></p>
<p>Данный плагин платный, его цена составляет 5 WMZ, приобреести его на сайте <a href="http://tsvshop.tsv.org.ua/zagruzit/plaginyi/tsvsparam-dopolnitelnyie-parametryi-tovarov.html">http://tsvshop.tsv.org.ua/zagruzit/plaginyi/tsvsparam-dopolnitelnyie-parametryi-tovarov.html</a>.</p>

<h2>Чанки, шаблоны, плейсхолдеры</h2>
<h3>Чанк product</h3>
<p>Используется совместно со сниппетом Ditto для вывода товаров из каталога. Минимальный код, который треубется для корректной работы чанка и добавления в корзину, следующий:</p>
<code>
&lt;form action="index.php" method="post" name="Tovar[+id+]" id="Tovar[+id+]"&gt;
[+tsvoptions+]
[+tsvprice+] руб.
&lt;input type="number" name="qty" value="1" [+tsvbattr+] /&gt;
&lt;a href="javascript: void(0);" onclick="AddToCart('[+id+]');return false"&gt;В корзину&lt;/a&gt;
[+tsvservices+]
&lt;/form&gt;
</code>
<p>Вы можете редактировать чанк как желаете, главное, чтобы в вашем коде сохранились вышеприведенные плейсхолдеры, форма и ссылка на добавление товара в корзину. Их месторасположение в чанке не имеет значение, главное, чтобы они были внутри формы.</p>
<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка product</td>
</tr>
<tr>
<td>id="Tovar[+id+]"</td><td>наличие в теге form <b>обязательно</b></td>
</tr>

<tr>
<td>[+tsvprice+]</td>
<td>Выводит окончательную стоимость товара на страницу. Выводимая этим плейсхолдером стоимость товара подсчитывается динамически, учитывая дополнительные параметры товара, скидки и т.д. Например, если у товара есть дополнительные параметры: цена, размер и т.д. и которые имеют свою цену, то при выборе определенного цвета окончательная сумма сразу же отображается вместо данного плейсхолдера. Смотрите пример использования в стандартном чанке product</td>
</tr>
<tr>
<td>[+tsvoptions+]</td>
<td>Выводит список дополнительных параметров товара: выпадающий список, checkbox, radiobutton. Смотрите пример использования в стандартном чанке product. Наличие в теге form <b>обязательно</b>, даже если не будут использоваться дополнительные параметры товаров.</td>
</tr>
<tr>
<td>[+cart_icon+]</td>
<td>Выводит ПУТЬ к картинке товара, которая будет отображаться в корзине. Используйте TV-параметр <b>cart_icon</b>. Используется в таком виде: <i>&lt;input type="hidden" name="cart_icon" value="[+cart_icon+]" /&gt;</i>. Важно, что TV cart_icon должнен возвращать ПУТЬ к картинке, а не саму куртинку. <b>Использование в чанке обязательно, даже если вы не планируете использовать картинку товара.</b> Смотрите пример использования в стандартном чанке product</td>
</tr>
<tr>
<td>[+tsvservices+]</td>
<td>Служебный плейсхолдер, который выводит функции, необходимые для формирования окончательной цены товара. <b>Использовать в чанке товара обязательно.</b> Также он должен быть размещен <u>в самом конце формы</u>, после всех плейсхолдеров. Смотрите пример использования в стандартном чанке product</td>
</tr>
<tr>
<td>[+tsvbattr+]</td>
<td>Служебный плейсхолдер, который выводит дополнительные атрибуты для поля количества заказанного товара. Используется так: <i>&lt;input type="number" name="qty" value="1" [+tsvbattr+] /&gt;</i>. В результате выводится: <i>&lt;input type="text" name="qty" value="1" onkeypress="return testKey(event)" onChange="UserCalc('[+id+]')" /&gt;</i>. Если вы собираетесь использовать поле Количество, то этот плейсхолдер <b>использовать обязательно</b>.</td>
</tr>
</table>

<h3>Чанк Shop_Cart</h3>
<p>Предназначен для вывода корзины заказов при вызове [[TSVshop? &act=`basket`]]</p>

<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_Cart</td>
</tr>
<tr>
<td width="200">[+shop.basket.iconpath+]</td>
<td>Путь к маленькому фото товара. Используйте TV-параметр <b>cart_icon</b>. Служит для вставки в тег <b>img</b> в атрибут <i>src</i>. Чтобы картинка стала доступной в корзине, нужно в чанке товара добавить скрытое поле с именем <i>cart_icon</i>, а в качестве значения вставить TV <i>cart_icon</i>. Например, <i>&lt;input type="hidden" name="cart_icon" value="[+cart_icon+]" /&gt;</i>. Пример смотрите в стандартном чанке <i>product</i>. Важно, что TV cart_icon должнен возвращать ПУТЬ к картинке, а не саму куртинку. При отсутствии картинки в TV cart_icon подставляется картинка по-умолчанию: assets/snippets/tsvshop/images/noimage.png </td>
</tr>
<tr>
<td width="200">[+shop.basket.num+]</td>
<td>Порядковый номер товара в корзине.  Можно использовать для
своих нужд, например, пронумеровать товары в корзине или для подстановки в вызовы функций:
onChange="ChangeQuantity('[+shop.basket.num+]', 4);"  (этот вызов отправит ajax-
запрос, изменив кол-во текущего товара в корзине до 4 единиц) и т.д.</td>
</tr>
<tr>
<td width="200">[+shop.basket.articul+]</td>
<td>Артикул товара</td>
</tr>
<tr>
<td>[+shop.basket.name+]</td>
<td>Наименование товара. Какое поле товара будет использоваться, можно установить параметром сниппета &namesource=``, напр., &namesource=`longtitle`. По умолчанию используется pagetitle</td>
</tr>
<tr>
<td>[+shop.basket.details+]</td>
<td>Дополнительные параметры товара</td>
</tr>
<tr>
<td>[+shop.basket.link+]</td>
<td>Адрес к странице с товаром. Используется для создания ссылки на страницу товара.</td>
</tr>
<tr>
<td>[+shop.basket.id+]</td>
<td>ID товара. Можно использовать на свое усмотрение.</td>
</tr>
<tr>
<td>[+shop.basket.monetary+]</td>
<td>Используемая валюта, например, <i>руб.</i>, <i>грн</i>. Берется из языкового файла.</td>
</tr>
<tr>
<td>[+shop.basket.qinput+]</td>
<td>Выводит полностью сформированное поле <i>Количество</i>, которое в корзине используется для вывода количества заказанного товара. Это поле будет сформированно автоматически, со всеми нужными атрибутами. На выходе получится приблизительно следующее: <i>&lt;input type="text" size="3" name="q" value="1" onkeypress="return testKey(event)" onchange="ChangeQuantity(1, this.value);" &gt;</i> <b>Внимание! Используйте данный вариант ТОЛЬКО при формировании корзины заказа в режиме basket (<i>&act=`basket`</i>). При формировании корзины оформления покупки - режим checkout (<i>&act=`checkout`</i>) - используйте следующий плейсхолдер [+shop.checkout.quantity+]</b>. Т.е. при оформлении покупки в корзине НЕЛЬЗЯ использовать поля ввода.</td>
</tr>
<tr>
<td>[+shop.basket.quantity+]</td>
<td>Количество заказанного товара.</td>
</tr>
<tr>
<td>[+shop.basket.qatributs+]</td>
<td>Служебные атрибуты, которые вставляются в тэг <i>input</i> поля <i>Количество</i>. Используйте в случае, если вы решили не пользоваться автоматической генерацией поля с помощью [+shop.checkout.qinput+]. Для создания в корзине поля ввода Количества вам достаточно вставить следующее: <i>&lt;input type="text" size="3" [+shop.checkout.qatributs+]&gt;</i>. В результате на выходе будет: <i>&lt;input type="text" size="3" name="q" value="количество" onkeypress="return testKey(event)" onchange="ChangeQuantity(количество, this.value);" &gt;</i>. Т.е. вместо плейсхолдера выведутся все служебные атрибуты, необходимые для работы поля Количества.</td>
</tr>
<tr>
<td>[+shop.basket.price+]</td>
<td>Цена одного экземпляра товара.</td>
</tr>
<tr>
<td>[+shop.basket.summa+]</td>
<td>Общая стоимость одного наименования товара. Результат вычисления Цена * Количество.</td>
</tr>
<tr>
<td>[+shop.basket.delatributs+]</td>
<td>Cлужебные атрибуты, которые служат для создания кнопки удаления товара из корзины. Например: <i>&lt;a href="#" [+shop.checkout.delatributs+]&gt;Удалить&lt;/a&gt;</i> на выходе создаст <i>&lt;a href="#" onclick="RemoveFromCart(1); return false" &gt;Удалить&lt;/a&gt;</i>. Или то же самое с тегом <i>button</i>. Т.е. вместо плейсхолдера будут вставлены служебные атрибуты, необходимые для корректной работы кнопки.</td>
</tr>
<tr>
<td>[+shop.basket.subtotal+]</td>
<td>Сумма подитога. Включает в себя чистую общую сумму всего заказа, без наценок, скидок и стоимости доставки.</td>
</tr>
<tr>
<td>[+shop.basket.discountcard+]</td>
<td>Номер дисконтной карты.</td>
</tr>
<tr>
<td>[+shop.basket.discount+]</td>
<td>Размер скидки.</td>
</tr>
<tr>
<td>[+shop.basket.discountsize+]</td>
<td>Итоговая сумма скидки.</td>
</tr>
<tr>
<td>[+shop.basket.shipping+]</td>
<td>Стоимость доставки.</td>
</tr>
<tr>
<td>[+shop.basket.tax+]</td>
<td>Размер налога.</td>
</tr>
<tr>
<td>[+shop.basket.total+]</td>
<td>Итоговая сумма всего заказа. Учтены все наценки, налоги, доставка и скидка.</td>
</tr>
<tr>
<td>[+shop.basket.topay+]</td>
<td><span style="color:red">Будет доступен с версии TSVshop 5.3</span><br />
Сумма к оплате. Эта сумма может отличаться от итоговой суммы (плейсхолдер [+shop.basket.total+]), если установлен аддон Подарочные сертификаты (и подобные, когда пользователь может часть суммы оплатить подарочным сертификатом, а оставшуюся – другими способами). В таком случае [+shop.basket.topay+] отобразит <u>оставшуюся</u> сумму, которую нужно <u>доплатить</u>. Рекомендуем в таких случаях для вывода оставшейся суммы оплаты использовать этот плейсхолдер.<br />
В более ранних версиях TSVshop используйте [+shop.basket.total+]
</td>
</tr>

<tr>
<td>[+shop.checkurl+]</td>
<td>Путь к странице с оформлением покупки. Используется для кнопки ОФОРМИТЬ ЗАКАЗ.</td>
</tr>
<tr>
<td>[+shop.selfurl+]</td>
<td>Путь к текущей странице корзины. Используется для кнопки ПЕРЕСЧИТАТЬ или ОЧИСТИТЬ КОРЗИНУ.</td>
</tr>
<tr>
<td>[+tv.имяtv+]</td>
<td>Выводит значение указанного TV-параметра. Напр., [+tv.color+] выведет значение TV color Для этого товара. <b>Важно! Чтобы это сработало, в вызове TSVshop нужно добавить параметр &tvs=`` с перечислением нужных TV-параметров через запятую, т.е, например, &tvs=`mytv1,mytv2`. Не указанные в параметре TV игнорируются!</b></td>
</tr>
<tr>
<td>&lt;!--noempty--&gt; и &lt;!--/noempty--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в формировании строк с заказом, когда в корзине имеется хотя бы один товар. Смотрите пример в стандартном чанке Shop_Cart.</td>
</tr>
<tr>
<td>&lt;!--subtotal--&gt; и &lt;!--/subtotal--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в формировании строки с подитогом. Смотрите пример в стандартном чанке Shop_Cart.</td>
</tr>
<tr>
<td>&lt;!--название_аддона--&gt; и &lt;!--/название_аддона--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в выводе информации из соответствующего аддона. Название аддона соответствует названию папки с аддоном в /assets/snippets/tsvshop/addons/. Например, информация из аддона Дисконтные карты (папка discount) будет выведена между &lt;!--discount--&gt; и &lt;!--/discount--&gt;. Для других аддонов все аналогично (о плейсхолдерах аддонов читайте в документации к  ним).</td>
</tr>
<tr>
<td>&lt;!--buttons--&gt; и &lt;!--/buttons--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в формировании кнопок ПЕРЕСЧИТАТЬ, ОФОРМИТЬ ЗАКАЗ и т.д. Смотрите пример в стандартном чанке Shop_Cart. Используйте только при формировании корзины в режиме basket (&act=`basket`)</td>
</tr>

</table>

<br />

<h3>Чанк Shop_Checkout</h3>

<p>Предназначен для вывода корзины оформления заказа и формы заказа при вызове [!TSVshop? &act=`checkout`!]</p>

<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_Checkout</td>
</tr>
<tr>
<td width="200">[+shop.basket.iconpath+]</td>
<td>Путь к маленькому фото товара. Используйте TV-параметр <b>cart_icon</b>. Служит для вставки в тег <b>img</b> в атрибут <i>src</i>. Чтобы картинка стала доступной в корзине, нужно в чанке товара добавить скрытое поле с именем <i>cart_icon</i>, а в качестве значения вставить TV <i>cart_icon</i>. Например, <i>&lt;input type="hidden" name="cart_icon" value="[+cart_icon+]" /&gt;</i>. Пример смотрите в стандартном чанке <i>product</i>. Важно, что TV cart_icon должнен возвращать ПУТЬ к картинке, а не саму куртинку. При отсутствии картинки в TV cart_icon подставляется картинка по-умолчанию: assets/snippets/tsvshop/images/noimage.png </td>
</tr>
<tr>
<td width="200">[+shop.basket.num+]</td>
<td>Порядковый номер товара в корзине.  Можно использовать для
своих нужд, например, пронумеровать товары в корзине или для подстановки в вызовы функций:
onChange="ChangeQuantity('[+shop.basket.num+]', 4);"  (этот вызов отправит ajax-
запрос, изменив кол-во текущего товара в корзине до 4 единиц) и т.д.</td>
</tr>
<tr>
<td width="200">[+shop.basket.articul+]</td>
<td>Артикул товара</td>
</tr>
<tr>
<td>[+shop.basket.name+]</td>
<td>Наименование товара. Какое поле товара будет использоваться, можно установить параметром сниппета &namesource=``, напр., &namesource=`longtitle`. По умолчанию используется pagetitle</td>
</tr>
    <tr>
<td>[+shop.basket.details+]</td>
<td>Дополнительные параметры товара</td>
</tr>
<tr>
<td>[+shop.basket.link+]</td>
<td>Адрес к странице с товаром. Используется для создания ссылки на страницу товара.</td>
</tr>
<tr>
<td>[+shop.basket.id+]</td>
<td>ID товара. Можно использовать на свое усмотрение.</td>
</tr>
<tr>
<td>[+shop.basket.monetary+]</td>
<td>Используемая валюта, например, <i>руб.</i>, <i>грн</i>. Берется из языкового файла.</td>
</tr>
<tr>
<td>[+shop.basket.qinput+]</td>
<td>Выводит полностью сформированное поле <i>Количество</i>, которое в корзине используется для вывода количества заказанного товара. Это поле будет сформированно автоматически, со всеми нужными атрибутами. На выходе получится приблизительно следующее: <i>&lt;input type="text" size="3" name="q" value="1" onkeypress="return testKey(event)" onchange="ChangeQuantity(1, this.value);" &gt;</i> <b>Внимание! Используйте данный вариант ТОЛЬКО при формировании корзины заказа в режиме basket (<i>&act=`basket`</i>). При формировании корзины оформления покупки - режим checkout (<i>&act=`checkout`</i>) - используйте следующий плейсхолдер [+shop.basket.quantity+]</b>. Т.е. при оформлении покупки в корзине НЕЛЬЗЯ использовать поля ввода.</td>
</tr>
<tr>
<td>[+shop.basket.quantity+]</td>
<td>Количество заказанного товара.</td>
</tr>
<tr>
<td>[+shop.basket.qatributs+]</td>
<td>Служебные атрибуты, которые вставляются в тэг <i>input</i> поля <i>Количество</i>. Используйте в случае, если вы решили не пользоваться автоматической генерацией поля с помощью [+shop.basket.qinput+]. Для создания в корзине поля ввода Количества вам достаточно вставить следующее: <i>&lt;input type="text" size="3" [+shop.basket.qatributs+]&gt;</i>. В результате на выходе будет: <i>&lt;input type="text" size="3" name="q" value="количество" onkeypress="return testKey(event)" onchange="ChangeQuantity(количество, this.value);" &gt;</i>. Т.е. вместо плейсхолдера выведутся все служебные атрибуты, необходимые для работы поля Количества.</td>
</tr>
<tr>
<td>[+shop.basket.price+]</td>
<td>Цена одного экземпляра товара.</td>
</tr>
<tr>
<td>[+shop.basket.summa+]</td>
<td>Общая стоимость одного наименования товара. Результат вычисления Цена * Количество.</td>
</tr>
<tr>
<td>[+shop.basket.delatributs+]</td>
<td>Cлужебные атрибуты, которые служат для создания кнопки удаления товара из корзины. Например: <i>&lt;a href="#" [+shop.basket.delatributs+]&gt;Удалить&lt;/a&gt;</i> на выходе создаст <i>&lt;a href="#" onclick="RemoveFromCart(1); return false" &gt;Удалить&lt;/a&gt;</i>. Или то же самое с тегом <i>button</i>. Т.е. вместо плейсхолдера будут вставлены служебные атрибуты, необходимые для корректной работы кнопки.</td>
</tr>
<tr>
<td>[+shop.basket.subtotal+]</td>
<td>Сумма подитога. Включает в себя чистую общую сумму всего заказа, без наценок, скидок и стоимости доставки.</td>
</tr>
<tr>
<td>[+shop.basket.discountcard+]</td>
<td>Номер дисконтной карты.</td>
</tr>
<tr>
<td>[+shop.basket.discount+]</td>
<td>Размер скидки.</td>
</tr>
<tr>
<td>[+shop.basket.discountsize+]</td>
<td>Итоговая сумма скидки.</td>
</tr>
<tr>
<td>[+shop.basket.shipping+]</td>
<td>Стоимость доставки.</td>
</tr>
<tr>
<td>[+shop.basket.tax+]</td>
<td>Размер налога.</td>
</tr>
<tr>
<td>[+shop.basket.total+]</td>
<td>Итоговая сумма всего заказа. Учтены все наценки, налоги, доставка и скидка.</td>
</tr>
<tr>
<td>[+shop.basket.topay+]</td>
<td><span style="color:red">Будет доступен с версии TSVshop 5.3</span><br />
Сумма к оплате. Эта сумма может отличаться от итоговой суммы (плейсхолдер [+shop.basket.total+]), если установлен аддон Подарочные сертификаты (и подобные, когда пользователь может часть суммы оплатить подарочным сертификатом, а оставшуюся – другими способами). В таком случае [+shop.basket.topay+] отобразит <u>оставшуюся</u> сумму, которую нужно <u>доплатить</u>. Рекомендуем в таких случаях для вывода оставшейся суммы оплаты использовать этот плейсхолдер.<br />
В более ранних версиях TSVshop используйте [+shop.basket.total+]
</td>
</tr>
<tr>
<td>[+shop.basket.userform+]</td>
<td>Вместо данного плейсхолдера выведется полностью сформированная форма заказа покупки с помощью сниппета eForm.</td>
</tr>
<tr>
<td>[+shop.checkurl+]</td>
<td>Путь к странице с оформлением покупки. Используется для кнопки ОФОРМИТЬ ЗАКАЗ.</td>
</tr>
<tr>
<td>[+shop.selfurl+]</td>
<td>Путь к текущей странице корзины. Используется для кнопки ПЕРЕСЧИТАТЬ или ОЧИСТИТЬ КОРЗИНУ.</td>
</tr>
<tr>
<td>[+tv.имяtv+]</td>
<td>Выводит значение указанного TV-параметра. Напр., [+tv.color+] выведет значение TV color Для этого товара. <b>Важно! Чтобы это сработало, в вызове TSVshop нужно добавить параметр &tvs=`` с перечислением нужных TV-параметров через запятую, т.е, например, &tvs=`mytv1,mytv2`. Не указанные в параметре TV игнорируются!</b></td>
</tr>
<tr>
<td>&lt;!--noempty--&gt; и &lt;!--/noempty--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в формировании строк с заказом, когда в корзине имеется хотя бы один товар. Смотрите пример в стандартном чанке Shop_Checkout. <b>Выделять участок шаблона обязательно!</b></td>
</tr>
<tr>
<td>&lt;!--subtotal--&gt; и &lt;!--/subtotal--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в формировании строки с подитогом. Смотрите пример в стандартном чанке Shop_Checkout. <b>Выделять участок шаблона обязательно!</b></td>
</tr>
<tr>
<td>&lt;!--название_аддона--&gt; и &lt;!--/название_аддона--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в выводе информации из соответствующего аддона. Название аддона соответствует названию папки с аддоном в /assets/snippets/tsvshop/addons/. Например, информация из аддона Дисконтные карты (папка discount) будет выведена между &lt;!--discount--&gt; и &lt;!--/discount--&gt;. Для других аддонов все аналогично (о плейсхолдерах аддонов читайте в документации к  ним). Если аддон не установлен, его код будет вырезан из шаблона автоматически, чтобы не выводить лишнее.</td>
</tr>

</table>

<br />
<h3>Чанк Shop_Cart_Empty</h3>
<p>Предназначен для вывода пустой корзины заказов. В этом чанке нету плейсхолдеров, поэтому редактировать его вы можете по своему желанию.</p>


<br />
<h3>Чанк Shop_UserForm</h3>
<p>Предназначен для вывода формы пользователя при оформлении покупки. Полностью сгенерированная форма выводится в чанк Shop_Checkout вместо плейсхолдера [+shop.basket.userform+]. Используется сниппетом eForm. Поэтому в данном чанке вы можете использовать синтаксис eForm как пожелаете. Приводим лишь плейсхолдеры, используемые в работе TSVshop: </p>
<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_UserForm</td>
</tr>
<tr>
<td>[+shop.basket.login+]</td>
<td>Логин пользователя, который он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Может пригодится.</td>
</tr>
<tr>
<td>[+shop.basket.userid+]</td>
<td>ID пользователя, под которым он числится в базе пользователей. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Может пригодится.</td>
</tr>
<tr>
<td>[+shop.basket.fullname+]</td>
<td>ФИО пользователя, которое он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Можете использовать в форме оформления покупки, чтобы авторизованный пользователь не вводил одни и те же данные много раз.</td>
</tr>
<tr>
<td>[+shop.basket.email+]</td>
<td>E-mail пользователя, которое он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Можете использовать в форме оформления покупки, чтобы авторизованный пользователь не вводил одни и те же данные много раз.</td>
</tr>
<tr>
<td>[+shop.basket.country+]</td>
<td>Страна пользователя, которую он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Можете использовать в форме оформления покупки, чтобы авторизованный пользователь не вводил одни и те же данные много раз.</td>
</tr>
<tr>
<td>[+shop.basket.state+]</td>
<td>Область/район/штат пользователя, который он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Можете использовать в форме оформления покупки, чтобы авторизованный пользователь не вводил одни и те же данные много раз.</td>
</tr>
<tr>
<td>[+shop.basket.zip+]</td>
<td>Индекс пользователя, который он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Может понадобится.</td>
</tr>
<tr>
<td>[+shop.basket.fax+]</td>
<td>Факс пользователя, который он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Может понадобится.</td>
</tr>
<tr>
<td>[+shop.basket.phone+]</td>
<td>Телефон пользователя, который он ввел при регистрации. Используется, если пользователь уже зарегистрирован и авторизовался. Данные берутся из его профиля. Можете использовать в форме оформления покупки, чтобы авторизованный пользователь не вводил одни и те же данные много раз.</td>
</tr>
<tr>
<td>[+shop.basket.fpayments+]</td>
<td>Полностью сформированное поле с выбором доступных пользователю методов оплаты (<a href="http://tsvshop.tsv.org.ua/zagruzit/addonyi/metodyi-oplatyi1.html">Аддон Методы оплаты</a> приобретается отдельно и потом устанавливается.)</td>
</tr>
<tr>
<td>[+shop.basket.fshipping+]</td>
<td>Полностью сформированное поле с выбором доступных пользователю методов доставки (<a href="http://tsvshop.tsv.org.ua/zagruzit/addonyi/metodyi-dostavki.html">Аддон Методы доставки</a> приобретается отдельно и потом устанавливается.)</td>
</tr>
<tr>
<td>[+shop.basket.fdiscount+]</td>
<td>Полностью сформированное поле с вводом номера дисконтной карты (<a href="http://tsvshop.tsv.org.ua/zagruzit/addonyi/addon-diskontnyie-kartyi.html">Модуль Дисконтные карты</a> приобретается отдельно и потом устанавливается.)</td>
</tr>
<tr>
<td>[+shop.basket.fsertificats+]</td>
<td>Полностью сформированное поле с вводом номера подарочного сертификата (<a href="http://tsvshop.tsv.org.ua/zagruzit/addonyi/addon-podarochnye-sertifikaty.html">Аддон Подарочные сертификаты</a> приобретается отдельно и потом устанавливается.)</td>
</tr>
<tr>
<td>&lt;!--название_аддона--&gt; и &lt;!--/название_аддона--&gt;</td>
<td>Выделяют часть шаблона, который учавствует в выводе информации из соответствующего аддона. Название аддона соответствует названию папки с аддоном в /assets/snippets/tsvshop/addons/. Например, информация из аддона Дисконтные карты (папка discount) будет выведена между &lt;!--discount--&gt; и &lt;!--/discount--&gt;. Для других аддонов все аналогично (о плейсхолдерах аддонов читайте в документации к  ним). Если аддон не установлен, его код будет вырезан из шаблона автоматически, чтобы не выводить лишнее.</td>
</tr> 
</table>
<br />

<h3>Чанк Shop_Infoblock</h3>
<p>Чанк предназначен для вывода инфоблока корзины с помощью вызова [[TSVshop? &act=`info`]]. </p>

<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_Infoblock</td>
</tr>
<tr>
<td  width="200">[+shop.info.iconpath+]</td>
<td>Путь к маленькому фото товара. Используйте TV-параметр <b>cart_icon</b>. Служит для вставки в тег <b>img</b> в атрибут <i>src</i>. Чтобы картинка стала доступной в корзине и инфоблоке, нужно в чанке товара добавить скрытое поле с именем <i>cart_icon</i>, а в качестве значения вставить TV <i>cart_icon</i>. Например, <i>&lt;input type="hidden" name="cart_icon" value="[+cart_icon+]" /&gt;</i>. Пример смотрите в стандартном чанке <i>product</i>. Важно, что TV cart_icon должнен возвращать ПУТЬ к картинке, а не саму куртинку. При отсутствии картинки в TV cart_icon подставляется картинка по-умолчанию: assets/snippets/tsvshop/images/noimage.png</td>
</tr>
<tr>
<td width="200">[+shop.info.num+]</td>
<td>Порядковый номер товара в корзине.  Можно использовать для
своих нужд, например, пронумеровать товары в корзине или для подстановки в вызовы функций:
onChange="ChangeQuantity('[+shop.basket.num+]', 4);"  (этот вызов отправит ajax-
запрос, изменив кол-во текущего товара в корзине до 4 единиц) и т.д.</td>
</tr>
<tr>
<td width="200">[+shop.info.articul+]</td>
<td>Артикул товара</td>
</tr>
<tr>
<td>[+shop.info.name+]</td>
<td>Наименование товара. Какое поле товара будет использоваться, можно установить параметром сниппета &namesource=``, напр., &namesource=`longtitle`. По умолчанию используется pagetitle</td>
</tr>
<tr>
<td>[+shop.info.details+]</td>
<td>Дополнительные параметры товара</td>
</tr>
<tr>
<td>[+shop.info.link+]</td>
<td>Адрес к странице с товаром. Используется для создания ссылки на страницу товара.</td>
</tr>
<tr>
<td width="200">[+shop.basket.id+]</td>
<td>ID товара</td>
</tr>
<tr>
<td>[+shop.info.quantity+]</td>
<td>Количество заказанного товара.</td>
</tr>
<tr>
<td>[+shop.info.price+]</td>
<td>Цена одного экземпляра товара.</td>
</tr>
<tr>
<td>[+shop.info.summa+]</td>
<td>Общая стоимость одного наименования товара. Результат вычисления Цена * Количество.</td>
</tr>
<tr>
<td>[+shop.info.delatributs+]</td>
<td>Cлужебные атрибуты, которые служат для создания кнопки удаления товара из корзины. Например: <i>&lt;a href="#" [+shop.basket.delatributs+]&gt;Удалить&lt;/a&gt;</i> на выходе создаст <i>&lt;a href="#" onclick="RemoveFromCart(1); return false" &gt;Удалить&lt;/a&gt;</i>. Или то же самое с тегом <i>button</i>. Т.е. вместо плейсхолдера будут вставлены служебные атрибуты, необходимые для корректной работы кнопки.</td>
</tr>
<tr>
<td  width="200">[+shop.info.count+]</td>
<td>Общее количество товаров в корзине</td>
</tr>
<tr>
<td>[+shop.info.stovar+]</td>
<td>Слово, которое ставится рядов с количеством товаров в корзине, например, 1 <i>Товар</i>, 2 <i>Товара</i>, 5 <i>Товаров</i>. Вместо данного плейсхолдера можно вставить свое слово, но все же предпочтительнее использовать именно данный плейсхолдер. Поскольку выводимое вместо него слово склоняется в зависимости от количества товаров в корзине, как указано в приведенном выше примере. </td>
</tr>
<tr>
<td>[+shop.info.ssumma+]</td>
<td>Поясняющая надпись перед суммой заказа. Например, <i>Сумма заказа</i>. Берется из языкового файла. При желании можно заменить своим словом.</td>
</tr>
<tr>
<td>[+shop.info.total+]</td>
<td>Общая сумма заказа.</td>
</tr>
<tr>
<td>[+shop.info.monetary+]</td>
<td>Используемая валюта, например, <i>руб.</i>, <i>грн.</i>. Берется из языкового файла.</td>
</tr>
<tr>
<td>[+shop.info.sempty+]</td>
<td>Фраза, выводимая в случае, когда корзина пуста. Берется из языкового файла.</td>
</tr>
<tr>
<td>[+shop.info.carturl+]</td>
<td>Путь к странице с корзиной. Используется для создания ссылки на корзину.</td>
</tr>
<tr>
<td>[+tv.имяtv+]</td>
<td>Выводит значение указанного TV-параметра. Напр., [+tv.color+] выведет значение TV color Для этого товара. <b>Важно! Чтобы это сработало, в вызове TSVshop нужно добавить параметр &tvs=`` с перечислением нужных TV-параметров через запятую, т.е, например, &tvs=`mytv1,mytv2`. Не указанные в параметре TV игнорируются!</b></td>
</tr>
<tr>
<td>&lt;!--table--&gt; и &lt;!--/table--&gt;</td>
<td>Выделают часть шаблона, которая будет использоваться для построения списка добавленных товаров. Пример использования смотрите в стандартном чанке Shop_Infoblock. При отсутствии в чанке таблица с товарами не выводится. <b>Пристутствие в чанке не обязательно!</b></td>
</tr>
<tr>
<td>&lt;!--full--&gt; и &lt;!--/full--&gt;</td>
<td>Выделают часть шаблона, которая будет использоваться для построения инфоблока, когда в корзине есть товары. Пример использования смотрите в стандартном чанке Shop_Infoblock. <b>Пристутствие в чанке обязательно!</b></td>
</tr>
<tr>
<td>&lt;!--empty--&gt; и &lt;!--/empty--&gt;</td>
<td>Выделают часть шаблона, которая будет использоваться для построения инфоблока, если корзина будет ПУСТОЙ. Пример использования смотрите в стандартном чанке Shop_Infoblock. <b>Пристутствие в чанке обязательно!</b></td>
</tr>

</table>

<br />

<h3>Чанк Shop_mail_admin</h3>
<p>Данный чанк предназначен для формирования письма о заказе администратору магазина.</p>
<p>В данном чанке корректно обрабатываются сниппеты [! !] или [[ ]], чанки {{ }}, плейсхолдеры [+ +], системные переменные [( )] , [~ ~], а также при обработке этого чанка срабатывают все события, которые относятся к парсингу страниц. Кроме того, для вывода данных из корзины используйте следующие плейсхолдеры (их можно комбинировать с перечисленными выше):</p>
<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_mail_admin</td>
</tr>

<tr>
<td  width="200">[+shop.mail.date+]</td>
<td>Дата отправки письма</td>
</tr>
<tr>
<td>[+shop.mail.numorder+]</td>
<td>Номер заказа</td>
</tr>
<tr>
<td>[+shop.mail.fio+]</td>
<td>ФИО заказчика или Полное наименование организации</td>
</tr>
<tr>
<td>[+shop.mail.city+]</td>
<td>Город заказчика</td>
</tr>
<tr>
<td>[+shop.mail.dostavka+]</td>
<td>Тип доставки</td>
</tr>

<tr>
<td>[+shop.mail.discountcard+]</td>
<td>Номер дисконтной карты. Если работа с дисконтными картами отключена, то данный плейсхолдер игнорируется.</td>
</tr>

<tr>
<td>[+shop.mail.discount+]</td>
<td>Размер скидки по указанной дисконтной карте. Если работа с дисконтными картами отключена, то данный плейсхолдер игнорируется.</td>
</tr>

<tr>
<td>[+shop.mail.adress+]</td>
<td>Адрес</td>
</tr>
<tr>
<td>[+shop.mail.region+]</td>
<td>Область, регион</td>
</tr>

<tr>
<td>[+shop.mail.province+]</td>
<td>Район</td>
</tr>
<tr>
<td>[+shop.mail.zip+]</td>
<td>Почтовый индекс</td>
</tr>
 
<tr>
<td>[+shop.mail.phone+]</td>
<td>Телефон</td>
</tr>

<tr>
<td>[+shop.mail.email+]</td>
<td>E-mail</td>
</tr>
<tr>
<td>[+shop.mail.code+]</td>
<td>Код доступа к заказу, если на сайте используется форма проверки заказа без личного кабинета.</td>
</tr>

<tr>
<td>[+shop.mail.tracking+]</td>
<td>Трекинг</td>
</tr>
<tr>
<td>[+shop.mail.comments+]</td>
<td>Комментарии к заказу</td>
</tr>

<tr>
<td>[+shop.mail.articul+]</td>
<td>Артикул товара</td>
</tr>
 	<tr>
 	<td width="200">[+shop.mail.id+]</td>
 	<td>ID товара</td>
</tr>
<tr>
<td width="200">[+shop.mail.link+]</td>
<td>Ссылка на товар. Вставляется в письмо так: &lt;a href="<b>[+shop.mail.link+]</b>" /&gt;[+shop.mail.name+]&lt;/a&gt;.</td>
</tr>

<tr>
<td width="200">[+shop.mail.num+]</td>
<td>Порядковый номер товара в корзине.  Можно использовать для
своих нужд, например, пронумеровать товары в корзине.</td>
</tr>

<tr>
<td>[+shop.mail.name+]</td>
<td>Наименование товара</td>
</tr>
 <tr>
<td width="200">[+shop.mail.icon+]</td>
<td>Путь к картинке товара. Можно использовать так: &lt;img src="http://sitename.com[+shop.mail.icon+]" /&gt;</td> 
</tr>
<tr>
<td>[+shop.mail.quantity+]</td>
<td>Количество одного наименования товара</td>
</tr>

<tr>
<td>[+shop.mail.price+]</td>
<td>Цена одного наименования товара</td>
</tr>
<tr>
<td>[+tv.имяtv+]</td>
<td>Выводит значение указанного TV-параметра. Напр., [+tv.color+] выведет значение TV color Для этого товара. <b>Важно! Чтобы это сработало, в вызове TSVshop нужно добавить параметр &tvs=`` с перечислением нужных TV-параметров через запятую, т.е, например, &tvs=`mytv1,mytv2`. Не указанные в параметре TV игнорируются!</b></td>
</tr>
<tr>
<td>[+shop.mail.subtotal+]</td>
<td>Подитог стоимости заказа</td>
</tr>

<tr>
<td>[+shop.mail.shipping+]</td>
<td>Цена доставки</td>
</tr>

<tr>
<td>[+shop.mail.shiptype+]</td>
<td>Тип доставки</td>
</tr>

<tr>
<td>[+shop.mail.nalog+]</td>
<td>Налог</td>
</tr>

<tr>
<td>[+shop.mail.payments+]</td>
<td>Метод оплаты</td>
</tr>

<tr>
<td>[+shop.mail.discountnum+]</td>
<td>Номер дисконтной карты</td>
</tr>
<tr>
<td>[+shop.mail.discount+]</td>
<td>Скидка по данной дисконтной карте</td>
</tr>
<tr>
<td>[+shop.mail.discountsize+]</td>
<td>Итоговая сумма скидки</td>
</tr>
<tr>
<td>[+shop.mail.total+]</td>
<td>Полная стоимость заказа</td>
</tr>
<tr>
<td>[+shop.mail.topay+]</td>
<td><span style="color:red">Будет доступен с версии TSVshop 5.3</span><br />
Сумма к оплате. Эта сумма может отличаться от итоговой суммы (плейсхолдер [+shop.mail.total+]), если установлен аддон Подарочные сертификаты (и подобные, когда пользователь может часть суммы оплатить подарочным сертификатом, а оставшуюся – другими способами). В таком случае [+shop.mail.topay+] отобразит <u>оставшуюся</u> сумму, которую нужно <u>доплатить</u>. Рекомендуем в таких случаях для вывода оставшейся суммы оплаты использовать этот плейсхолдер.<br />
В более ранних версиях TSVshop используйте [+shop.mail.total+]
</td>
</tr>
<tr>
<td>[+shop.mail.monetary+]</td>
<td>Валюта, например, руб.</td>
</tr>
<tr>
<td>&lt;!--table--&gt; и &lt;!--/table--&gt;</td>
<td>Выделают часть шаблона, которая будет использоваться для построения списка заказанных товаров. Пример использования смотрите в стандартном чанке Shop_mail_admin</td>
</tr>
<tr>
<td>[+shop.mail.ключ_поля+]</td>
<td>Значение любого поля формы оформления заказа (чанк Shop_UserForm). Напр., значение поля c name="myfield" вставится вместо плейсхолдера [+shop.mail.myfield+] и т.д.</td>
</tr>
</table>

<br />

<h3>Чанк Shop_mail_klient</h3>
<p>Данный чанк предназначен для формирования письма о заказе клиенту.</p>
<p>В данном чанке корректно обрабатываются сниппеты [! !] или [[ ]], чанки {{ }}, плейсхолдеры [+ +], системные переменные [( )] , [~ ~], а также при обработке этого чанка срабатывают все события, которые относятся к парсингу страниц. Кроме того, для вывода данных из корзины используйте следующие плейсхолдеры (их можно комбинировать с перечисленными выше):</p>
<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_mail_klient</td>
</tr>
<tr>
<td  width="200">[+shop.mail.date+]</td>
<td>Дата отправки письма</td>
</tr>
<tr>
<td>[+shop.mail.numorder+]</td>
<td>Номер заказа</td>
</tr>
<tr>
<td>[+shop.mail.fio+]</td>
<td>ФИО заказчика или Полное наименование организации</td>
</tr>
<tr>
<td>[+shop.mail.city+]</td>
<td>Город заказчика</td>
</tr>
<tr>
<td>[+shop.mail.dostavka+]</td>
<td>Тип доставки</td>
</tr>

<tr>
<td>[+shop.mail.discountcard+]</td>
<td>Номер дисконтной карты. Если работа с дисконтными картами отключена, то данный плейсхолдер игнорируется.</td>
</tr>

<tr>
<td>[+shop.mail.discount+]</td>
<td>Размер скидки по указанной дисконтной карте. Если работа с дисконтными картами отключена, то данный плейсхолдер игнорируется.</td>
</tr>

<tr>
<td>[+shop.mail.adress+]</td>
<td>Адрес</td>
</tr>
<tr>
<td>[+shop.mail.region+]</td>
<td>Область, регион</td>
</tr>

<tr>
<td>[+shop.mail.province+]</td>
<td>Район</td>
</tr>
<tr>
<td>[+shop.mail.zip+]</td>
<td>Почтовый индекс</td>
</tr>
 
<tr>
<td>[+shop.mail.phone+]</td>
<td>Телефон</td>
</tr>

<tr>
<td>[+shop.mail.email+]</td>
<td>E-mail</td>
</tr>
<tr>
<td>[+shop.mail.code+]</td>
<td>Код доступа к заказу, если на сайте используется форма проверки заказа без личного кабинета.</td>
</tr>

<tr>
<td>[+shop.mail.tracking+]</td>
<td>Трекинг</td>
</tr>
<tr>
<td>[+shop.mail.comments+]</td>
<td>Комментарии к заказу</td>
</tr>

<tr>
<td>[+shop.mail.articul+]</td>
<td>Артикул товара</td>
</tr>
<tr>
<td width="200">[+shop.mail.link+]</td>
<td>Ссылка на товар. Вставляется в письмо так: &lt;a href="<b>[+shop.mail.link+]</b>" /&gt;[+shop.mail.name+]&lt;/a&gt;.</td>
</tr>
<tr>
<td width="200">[+shop.mail.num+]</td>
<td>Порядковый номер товара в корзине.  Можно использовать для
своих нужд, например, пронумеровать товары в корзине.</td>
</tr>

<tr>
<td>[+shop.mail.name+]</td>
<td>Наименование товара</td>
</tr>
 <tr>
<td width="200">[+shop.mail.icon+]</td>
<td>Путь к картинке товара. Можно использовать так: &lt;img src="http://sitename.com[+shop.mail.icon+]" /&gt;</td>
</tr>
 	<tr>
 	<td width="200">[+shop.mail.id+]</td>
 	<td>ID товара</td>
</tr>
<tr>
<td>[+shop.mail.quantity+]</td>
<td>Количество одного наименования товара</td>
</tr>

<tr>
<td>[+shop.mail.price+]</td>
<td>Цена одного наименования товара</td>
</tr>
<tr>
<td>[+tv.имяtv+]</td>
<td>Выводит значение указанного TV-параметра. Напр., [+tv.color+] выведет значение TV color Для этого товара. <b>Важно! Чтобы это сработало, в вызове TSVshop нужно добавить параметр &tvs=`` с перечислением нужных TV-параметров через запятую, т.е, например, &tvs=`mytv1,mytv2`. Не указанные в параметре TV игнорируются!</b></td>
</tr>
<tr>
<td>[+shop.mail.subtotal+]</td>
<td>Подитог стоимости заказа</td>
</tr>

<tr>
<td>[+shop.mail.shipping+]</td>
<td>Цена доставки</td>
</tr>

<tr>
<td>[+shop.mail.shiptype+]</td>
<td>Тип доставки</td>
</tr>

<tr>
<td>[+shop.mail.nalog+]</td>
<td>Налог</td>
</tr>

<tr>
<td>[+shop.mail.payments+]</td>
<td>Метод оплаты</td>
</tr>

<tr>
<td>[+shop.mail.discountnum+]</td>
<td>Номер дисконтной карты</td>
</tr>
<tr>
<td>[+shop.mail.discount+]</td>
<td>Скидка по данной дисконтной карте</td>
</tr>
<tr>
<td>[+shop.mail.discountsize+]</td>
<td>Итоговая сумма скидки</td>
</tr>
<tr>
<td>[+shop.mail.total+]</td>
<td>Полная стоимость заказа</td>
</tr>
<tr>
<td>[+shop.mail.topay+]</td>
<td><span style="color:red">Будет доступен с версии TSVshop 5.3</span><br />
Сумма к оплате. Эта сумма может отличаться от итоговой суммы (плейсхолдер [+shop.mail.total+]), если установлен аддон Подарочные сертификаты (и подобные, когда пользователь может часть суммы оплатить подарочным сертификатом, а оставшуюся – другими способами). В таком случае [+shop.mail.topay+] отобразит <u>оставшуюся</u> сумму, которую нужно <u>доплатить</u>. Рекомендуем в таких случаях для вывода оставшейся суммы оплаты использовать этот плейсхолдер.<br />
В более ранних версиях TSVshop используйте [+shop.mail.total+]
</td>
</tr>
<tr>
<td>[+shop.mail.monetary+]</td>
<td>Валюта, например, руб.</td>
</tr>
<tr>
<td>&lt;!--table--&gt; и &lt;!--/table--&gt;</td>
<td>Выделают часть шаблона, которая будет использоваться для построения списка заказанных товаров. Пример использования смотрите в стандартном чанке Shop_mail_klient</td>
</tr>
<tr>
<td>[+shop.mail.ключ_поля+]</td>
<td>Значение любого поля формы оформления заказа (чанк Shop_UserForm). Напр., значение поля c name="myfield" вставится вместо плейсхолдера [+shop.mail.myfield+] и т.д.</td>
</tr>
</table>

<br />

<h3>Чанк Shop_UpdateOrder</h3>
<p>Данный чанк предназначен для формирования письма о заказе клиенту.</p>
<table width="100%">
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_UpdateOrder</td>
</tr>
<tr>
<td  width="200">[+shop.order.date+]</td>
<td>Дата отправки письма</td>
</tr>
<tr>
<td>[+shop.order.numorder+]</td>
<td>Номер заказа</td>
</tr>
<tr>
<td>[+shop.order.fio+]</td>
<td>ФИО заказчика или Полное наименование организации</td>
</tr>
<tr>
<td>[+shop.order.city+]</td>
<td>Город заказчика</td>
</tr>
<tr>
<td>[+shop.order.dostavka+]</td>
<td>Тип доставки</td>
</tr>

<tr>
<td>[+shop.order.discountcard+]</td>
<td>Номер дисконтной карты. Если работа с дисконтными картами отключена, то данный плейсхолдер игнорируется.</td>
</tr>

<tr>
<td>[+shop.order.discount+]</td>
<td>Размер скидки по указанной дисконтной карте. Если работа с дисконтными картами отключена, то данный плейсхолдер игнорируется.</td>
</tr>

<tr>
<td>[+shop.order.adress+]</td>
<td>Адрес</td>
</tr>
<tr>
<td>[+shop.order.region+]</td>
<td>Область, регион</td>
</tr>

<tr>
<td>[+shop.order.province+]</td>
<td>Район</td>
</tr>
<tr>
<td>[+shop.order.zip+]</td>
<td>Почтовый индекс</td>
</tr>
 
<tr>
<td>[+shop.order.phone+]</td>
<td>Телефон</td>
</tr>

<tr>
<td>[+shop.order.email+]</td>
<td>E-mail</td>
</tr>
<tr>
<td>[+shop.order.code+]</td>
<td>Код доступа к заказу, если на сайте используется форма проверки заказа без личного кабинета.</td>
</tr>

<tr>
<td>[+shop.order.tracking+]</td>
<td>Трекинг</td>
</tr>
<tr>
<td>[+shop.order.comments+]</td>
<td>Комментарии к заказу</td>
</tr>
<tr>
<td>[+shop.order.status+]</td>
<td>Новый статус заказа</td>
</tr>
<tr>
<td>[+shop.order.sitename+]</td>
<td>Название вашего сайта или интернет-магазина. Удобно использовать в подписи письма.</td>
</tr>
<tr>
<td>[+shop.order.articul+]</td>
<td>Артикул товара</td>
</tr>

<tr>
<td>[+shop.order.name+]</td>
<td>Наименование товара</td>
</tr>

<tr>
<td width="200">[+shop.order.num+]</td>
<td>Порядковый номер товара в корзине.  Можно использовать для
своих нужд, например, пронумеровать товары в корзине.</td>
</tr>

<tr>
<td>[+shop.order.quantity+]</td>
<td>Количество одного наименования товара</td>
</tr>

<tr>
<td>[+shop.order.price+]</td>
<td>Цена одного наименования товара</td>
</tr>

<tr>
<td>[+shop.order.subtotal+]</td>
<td>Подитог стоимости заказа</td>
</tr>

<tr>
<td>[+shop.order.shipping+]</td>
<td>Цена доставки</td>
</tr>

<tr>
<td>[+shop.order.shiptype+]</td>
<td>Тип доставки</td>
</tr>

<tr>
<td>[+shop.order.nalog+]</td>
<td>Налог</td>
</tr>

<tr>
<td>[+shop.order.payments+]</td>
<td>Метод оплаты</td>
</tr>

<tr>
<td>[+shop.order.discountnum+]</td>
<td>Номер дисконтной карты</td>
</tr>
<tr>
<td>[+shop.order.discount+]</td>
<td>Скидка по данной дисконтной карте</td>
</tr>
<tr>
<td>[+shop.order.discountsize+]</td>
<td>Итоговая сумма скидки</td>
</tr>
<tr>
<td>[+shop.order.total+]</td>
<td>Полная стоимость заказа</td>
</tr>
<tr>
<td>[+shop.order.topay+]</td>
<td><span style="color:red">Будет доступен с версии TSVshop 5.3</span><br />
Сумма к оплате. Эта сумма может отличаться от итоговой суммы (плейсхолдер [+shop.order.total+]), если установлен аддон Подарочные сертификаты (и подобные, когда пользователь может часть суммы оплатить подарочным сертификатом, а оставшуюся – другими способами). В таком случае [+shop.order.topay+] отобразит <u>оставшуюся</u> сумму, которую нужно <u>доплатить</u>. Рекомендуем в таких случаях для вывода оставшейся суммы оплаты использовать этот плейсхолдер.<br />
В более ранних версиях TSVshop используйте [+shop.order.total+]
</td>
</tr>
<tr>
<td>[+shop.order.monetary+]</td>
<td>Валюта, например, руб.</td>
</tr>
</table>

<br />
<h3>Чанк Shop_FinishText</h3>
<p>Этот чанк используется для формирования внешнего вида сообщения об успешной покупке, на завершающем этапе. Иногда эту страницу называют "Спасибо за покупку". Чанк обрабатывается при вызове:</p>
<pre class="html">[!TSVshop? &amp;act=`finish`!]</pre>
<p>В чанке доступны следующие плейсхолдеры:</p>
<!-- norender -->
<table border="0">
<tbody>
<tr>
<td colspan="2" class="head">Плейсхолдеры чанка Shop_FinishText</td>
</tr>
<tr>
<td>Плейсходер</td>
<td>Описание</td>
</tr>
<tr>
<td>[+shop.paylink+]</td>
<td>Полностью сгенерированная ссылка для перехода к оплате, напр., на сайт Robokassa, страницу с квитанцией и т.д. Это зависит от того, какой метод оплаты выбрал покупатель. Соответвующий метод оплаты должен быть установлен в модуле TSVshop в аддоне <strong>Методы оплаты</strong>.</td>
</tr>
<tr>
<td>[+shop.ключ_массива+]</td>
<td>Выводит любую переменную массива $_SESSION['tsvshopfin']['result']&nbsp; в зависимости от ключа. Напр., [+shop.numorder+] выведет переменную $_SESSION['tsvshopfin']['result']['numorder'] и т.д. Чтобы узнать состав массива, выведите его функцией print_r.</td>
</tr>
</tbody>
</table>
<!-- /norender -->
<p>В этот чанк можно вставлять вызовы сниппетов, чанки и плейсхолдеры - они будут обрабатываться корректно.</p>

<br />
<h2>Чанк Shop_PrintOrder - шаблон печати товарного чека/накладной в TSVshop</h2>
<p style="color:red"><b>Доступен с версии TSVshop 5.4</b></p>
<p>Этот чанк используется для формирования страницы для распечатывания товарного чека/накладной. Работает по нажатию на кнопку "Печать накладной" в админке в аддоне Заказы при просмотре конкретного заказа. Также можно позволить распечатать свою накладную пользователю-покупателю, прислав ему ссылку на страницу, где стоит такой вызов:</p>
<p><b>Внимание!</b> По-умолчанию в качестве шаблона используется не этот чанк, а файл <i>assets/snippets/tsvshop/addons/sales/tpl/Shop_PrintOrder.tpl</i>, плейсхолеры которого полностью аналогичны нижеописанным. Но при желании можно использовать в качестве шаблона и чанк, указав это явно (см. документацию к сниппету TSVshop).</p>
<p>[!TSVshop? &amp;act=`printorder`!] </p>
<p>В чанке доступны следующие плейсхолдеры:</p>
<table id="hinttable">
<thead>
<tr>
<td width="200" >
Плейсхолдер
</td>
<td  >
Описание
</td>
</tr>
</thead>
<tbody>
<tr>
<td >
<p>[+shop.order.id+]
</td>
<td  >
<p>ID товара/документа в дереве MODx
</td>
</tr>
<tr>
<td >
<p>[+shop.order.name+]
</td>
<td  >
<p>Название товара
</td>
</tr>
<tr>
<td >
<p>[+shop.order.articul+]
</td>
<td  >
<p>Артикул товара (если не задан, то выводится ID документа)
</td>
</tr>
<tr>
<td >
<p>[+shop.order.price+]
</td>
<td  >
<p>Цена за одну единицу
</td>
</tr>
<tr>
<td >
<p>[+shop.order.summa+]
</td>
<td  >
<p>Цена все единиц товара (цена*количество)
</td>
</tr>
<tr>
<td >
<p>[+shop.order.icon+]
</td>
<td  >
<p>Иконка товара
</td>
</tr>
<tr>
<td >
<p>[+shop.order.qty+]
</td>
<td  >
<p>Количество единиц товара
</td>
</tr>
<tr>
<td >
<p>[+shop.order.num+]
</td>
<td  >
<p>Порядковый номер товара в списке
</td>
</tr>
<tr>
<td >
<p>[+shop.order.numorder+]
</td>
<td  >
<p>Номер заказа
</td>
</tr>
<tr>
<td >
<p>[+shop.order.datecreate+]
</td>
<td  >
<p>Дата формирования квитанции текстом (в виде: 10 сентября 2012 г.)
</td>
</tr>
<tr>
<td >
<p>[+shop.order.discount+]
</td>
<td  >
<p>Размер скидки
</td>
</tr>
<tr>
<td >
<p>[+shop.order.discountsize+]
</td>
<td  >
<p>Сумма скидки (уже просчитанная)
</td>
</tr>
<tr>
<td >
<p>[+shop.order.count+] 
</td>
<td >
<p>Количество (отдельных товаров) позиций товаров в корзине
</td>
</tr>
<tr>
<td >  
<p>[+shop.order.totalcount+]
</td>
<td  >
<p>Общее количество всех единиц товаров в корзине
</td>
</tr>
<tr>
<td >
<p>[+shop.order.subtotal+]
</td>
<td  >
<p>Подитог суммы заказа
</td>
</tr>
<tr>
<td >
<p>[+shop.order.total+]
</td>
<td  >
<p>Итоговая сумма заказа
</td>
</tr>
<tr>
<td >
<p>[+shop.order.topay+]
</td>
<td  >
<p>Сумма к оплате (отличается от [+shop.order.total+] тем, что может быть меньше итоговой суммы в случае, если в интернет-магазине установлен аддон Подарочные сертификаты (и подобными) и пользователь может часть суммы заказа оплатить подарочным сертификатом, а оставшуюся часть - банковским платежем. Вот как раз в этом случае [+shop.order.topay+] будет равен <strong>оставшейся</strong> сумме, которую нужно <strong>доплатить</strong>. В то время как [+shop.order.total+] всегда будет равна всей стоимости заказа, независимо от того, оплачен ли заказа частично или полносью. Советуем всегда в качестве суммы <span style="text-decoration: underline;">к оплате</span> использовать именно&nbsp; [+shop.order.topay+])
</td>
</tr>
<tr>
<td >
<p>[+shop.order.total_propis+]
</td>
<td  >
<p>Итоговая сумма заказа ПРОПИСЬЮ. Т.е. сумма будет написана словами
</td>
</tr>
<tr>
<td >
<p>[+shop.mail.payments+]
</td>
<td  >
<p>Метод оплаты
</td>
</tr>
<tr>
<td >
<p>[+shop.order.fio+]
</td>
<td  >
<p>ФИО заказчика или название предприятия
</td>
</tr>
<tr>
<td >
<p>[+shop.order.adress+]
</td>
<td  >
<p>Адрес доставки или предприятия-получателя
</td>
</tr>
<tr>
<td >
<p>[+shop.order.city+]
</td>
<td  >
<p>Город
</td>
</tr>
<tr>
<td >
<p>[+shop.order.phone+]
</td>
<td  >
<p>Телефон
</td>
</tr>
<tr>
<td >
<p>[+shop.order.shiptype+]
</td>
<td >
Метод доставки 
</td>
</tr>
<tr>
<td >
[+shop.order.shipping+]
</td>
<td  >
Стоимость доставки
</td>
</tr>
<tr>
<td >
&lt;!--table--&gt; &lt;!--/table--&gt;
</td>
<td >
Выделяют область чанка, которая служит для формирования строк таблицы с товарами
</td>
</tr>
</tbody>
</table>


<h2>Структура и Редактирование чанков</h2>
<p>Внешний вид корзины изменяется в соответствующих чанках и файле <b>shop.css</b>, расположенном в папке со сниппетом. В чанке <i>product</i> используется форма и определенные поля формы. Вы можете редактировать чанк как угодно, главное, чтобы присутсвовали следующие элементы <br /> 
<code>
&lt;form action="index.php" method="post" name="Tovar[+id+]" id="Tovar[+id+]"&gt;
[+tsvoptions+]
[+tsvprice+] руб.
&lt;a href="javascript: void(0);" onclick="AddToCart('[+id+]');return false"&gt;В корзину&lt;/a&gt;
[+tsvservices+]
&lt;/form&gt;
</code>
<p>С помощью конструкции</p>
<code>&lt;a href="javascript: void(0);" onclick="AddToCart('[+id+]');return false"&gt;В корзину&lt;/a&gt;</code>
<p>происходит добавление товаров в корзину (Вместо ссылки можно использовать тег button или другой подходящий).</p>

<p>Для вставки поля количества добавляемых товаров добавьте в чанк ВНУТРЬ формы следующее:</p>
<code>&lt;input type="text" name="qty" size="5" [+tsvbattr+] /&gt;</code> 
<p>Наличие этого поля необязательно. Но если все же собираетесь ее оставить в чанке, то все параметры и плейсхолдер [+tsvbattr+] обязательные, кроме длины поля (size). Его можете менять как угодно.</p>

 <BLOCKQUOTE><h4>Описание функции AddToCart в шаблоне:</h4>

Вызов функции: AddToCart(ID_NUM)<br /><br />

<i>ID_NUM</i> – ID Товара (Это ИД документа или товара из каталога TSVcatalog);
 </p>
</BLOCKQUOTE>



<h2>Заключение</h2>
<p>Мы предоставляем услуги по разработке сайтов и интернет-магазинов на базе MODx, сниппетов, модулей, плагинов. А также готовы по вашему желанию доработать любой функционал для данного модуля TSVshop. Наши контакты на сайте <a href="http://tsvshop.tsv.org.ua/kontaktyi.html">http://tsvshop.tsv.org.ua/kontaktyi.html</a></p>

<p>Если вы хотети поспособствовать дальнейшему развитию данного модуля, вы можете добровольно переслать некоторую сумму на кошельки, указанные в контактах по ссылке выше.</p>



<p>Желаем вам успехов в ваших начинаниях. С уважением, команда разработчиков <a href="http://tsvshop.tsv.org.ua">TSVshop</a></p>
</body>
</html>





